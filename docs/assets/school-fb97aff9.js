import{_ as $,d as P,o as m,c as h,a as u,a3 as D,b as t,w as s,a9 as O,F as _,S as w,C as g,e as d}from"./index-d5078496.js";import{E as N,a as j,b as A}from"./el-input-979ff7e8.js";import{E as B}from"./el-overlay-4a657f48.js";import{_ as V}from"./BaiduMapModel-f5218769.js";import{E as n,a as z,b as R}from"./el-table-column-b98b4400.js";import{E as S}from"./el-popover-85297077.js";import{E as q}from"./el-button-3885cb18.js";import{s as U,a as I,b as W,c as Z}from"./school-eacb45c8.js";import{M as L}from"./maperstate-eb28c7f3.js";/* empty css                   */import{c as f}from"./cloneDeep-5a465b49.js";const X=P({data(){return{center:{},dialogMapVisible:!1,MainTitle:"学校",FuncObj:[U,I,W,Z],dat:{},topics:[],resultData:{},topic:{id:0,schoolName:"",province:"",area:"",city:"",address:"",description:"",enable:0,latitude:"",longitude:""},choseRow:{},dialogFormVisible:!1,formLabelWidth:70,dialogVisible:!1,wantAdd:!0,rules:{latitude:[{required:!0,message:"必须填写纬度!",trigger:"blur"}],longitude:[{required:!0,message:"必须填写经度！",trigger:"blur"}]}}},mounted(){this.getTopicPage()},methods:{showMapVisible(e){const o=L();this.center={lng:e.row.latitude,lat:e.row.longitude},o.setMapXy(this.center),console.log("kk--kk",o),this.dialogMapVisible=!this.dialogMapVisible,O.emit("wantOpenMapForCenter",this.center)},goToDepartmentPage(e){console.log("----去看看部门----",e),this.$router.push({name:"department",query:{id:e.row.id}})},goToTeacherPage(e){console.log("---去教师 -scope----",e.row.schoolName),this.$router.push({name:"teacher",query:{school:e.row.schoolName}})},getTopicPage(){this.FuncObj[3](this.requestData).then(e=>{e.success?(this.topics=Object.values(e.data)[0],this.resultData=e.data,this.setSomeThing(this.topic,this.topics[0],1),this.setObjPropsToNull(this.topic)):(n({message:"没有相关数据！！!",type:"warning"}),this.topics=[],this.topic={nodata:"NoData"})}).catch(e=>{console.log(e)})},showDialog(e,o){this.wantAdd=e,this.dat=f(o),e?(this.setObjPropsToNull(this.dat),this.dat={}):this.setSomeThing(this.topic,this.dat,2),this.dialogFormVisible=!0},del(e){const o={id:e};this.FuncObj[1](o).then(i=>{i.success?(n({message:"数据删除成功!",type:"success"}),this.getTopicPage(e)):n({message:"删除警告,数据删除失败!",type:"warning"})}).catch(i=>{})},async save(){await this.$refs.dialogFormRef.validate((e,o)=>{e?(this.wantAdd?this.FuncObj[0](this.dat).then(i=>{i.success?(n({message:"数据添加成功!",type:"success"}),this.getTopicPage()):(n({message:"数据添加失败!",type:"warning"}),console.log("数据添加失败!----->",i))}).catch(i=>{n.error("添加错误，网络接口出错！"),console.log("网路接口错误--->",res)}):(this.setSomeThing(this.topic,this.dat,1),this.FuncObj[2](this.dat).then(i=>{i.success?(n({message:"数据修改成功!",type:"success"}),this.getTopicPage()):(console.log(" 数据修改失败!--->  ",i),n({message:"数据修改失败!",type:"warning"}))}).catch(i=>{n.error("修改错误，网络接口出错！")})),this.dialogFormVisible=!1):console.log("error submit!",o)})},resetForm(){console.log(this.$refs.dialogFormRef),this.$refs.dialogFormRef.resetFields(),this.wantAdd?this.topic=f(this.topic):this.topic=f(this.dat)},setObjPropsToNull(e){Object.keys(e).forEach(o=>{e[o]=void 0})},setSomeThing(e,o,i){Object.keys(e).forEach(c=>{i==0?o[c]=e[c]:e[c]=o[c]})},components:{BaiduMapModel:V}}}),G={class:"tools"},H={class:"dialog-footer"};function J(e,o,i,c,K,Q){const p=R,r=q,T=S,F=z,C=V,b=B,y=N,M=j,k=A;return m(),h("div",null,[u("div",G,[u("p",null,D(e.MainTitle)+"管理",1)]),u("div",null,[t(F,{"max-height":"600",data:e.topics,style:{width:"100%"}},{default:s(()=>[(m(!0),h(_,null,w(e.topic,(l,a)=>(m(),g(p,{prop:a,label:a,key:a.id,formatter:e.getCategoryNameFormat},null,8,["prop","label","formatter"]))),128)),t(p,{label:"部门"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.goToDepartmentPage(l)},{default:s(()=>[d("结构")]),_:2},1032,["onClick"])]),_:1}),t(p,{label:"教师"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.goToTeacherPage(l)},{default:s(()=>[d("成员")]),_:2},1032,["onClick"])]),_:1}),t(p,{label:"地址"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.showMapVisible(l)},{default:s(()=>[d("位置")]),_:2},1032,["onClick"])]),_:1}),t(p,{fixed:"right",label:"功能管理",width:"170"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.showDialog(!1,l.row)},{default:s(()=>[d("编辑")]),_:2},1032,["onClick"]),t(T,{title:"删除将无法恢复！确定删除?",onConfirm:a=>e.del(l.row.id)},{reference:s(()=>[t(r,{size:"small",type:"danger"},{default:s(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),t(r,{icon:"Plus",style:{width:"100%","background-color":"#e3f7d8"},onClick:o[0]||(o[0]=l=>e.showDialog(!0,e.dat))}),t(b,{modelValue:e.dialogMapVisible,"onUpdate:modelValue":o[1]||(o[1]=l=>e.dialogMapVisible=l),width:"40%",center:""},{default:s(()=>[t(C,{Zoom:e.zoom,Center:e.center},null,8,["Zoom","Center"])]),_:1},8,["modelValue"]),t(b,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":o[3]||(o[3]=l=>e.dialogFormVisible=l),title:e.wantAdd?e.MainTitle+"添加":e.MainTitle+"修改"},{footer:s(()=>[u("span",H,[t(r,{onClick:o[2]||(o[2]=l=>e.resetForm())},{default:s(()=>[d("重置")]),_:1}),t(r,{type:"primary",onClick:e.save},{default:s(()=>[d(" 保存 ")]),_:1},8,["onClick"])])]),default:s(()=>[t(k,{ref:"dialogFormRef",model:e.dat,rules:e.rules},{default:s(()=>[(m(!0),h(_,null,w(e.topic,(l,a,v)=>(m(),g(M,{label:a,prop:a,key:v,"label-width":e.formLabelWidth},{default:s(()=>[(m(),g(y,{modelValue:e.dat[a],"onUpdate:modelValue":E=>e.dat[a]=E,autocomplete:"off",clearable:"",key:a},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label","prop","label-width"]))),128))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const de=$(X,[["render",J],["__scopeId","data-v-b6c9ce7e"]]);export{de as default};

import{_ as E,d as P,o as c,c as g,a as u,a3 as $,b as t,w as s,a9 as O,F as _,S as w,C as f,e as d}from"./index-d5b0a6e4.js";import{E as N,a as j,b as z}from"./el-input-d6573bb7.js";import{E as A}from"./el-overlay-cf244d20.js";import{_ as T}from"./BaiduMapModel-5464475a.js";import{E as n,a as B,b as q}from"./el-table-column-8681785a.js";import{E as R}from"./el-popover-5fd4b6c5.js";import{E as S}from"./el-button-0aef382d.js";import{s as U,a as I,b as W,c as Z}from"./school-2f93df6f.js";import{M as L}from"./maperstate-fc3ca8ee.js";/* empty css                   */import{c as h}from"./cloneDeep-62aa146b.js";const X=P({data(){return{center:{},dialogMapVisible:!1,MainTitle:"学校",FuncObj:[U,I,W,Z],dat:{},topics:[],resultData:{},topic:{id:0,schoolName:"",province:"",area:"",city:"",address:"",description:"",enable:0,latitude:"",longitude:""},choseRow:{},dialogFormVisible:!1,formLabelWidth:70,dialogVisible:!1,wantAdd:!0,rules:{}}},mounted(){this.getTopicPage()},methods:{showMapVisible(e){const o=L();this.center={lng:e.row.latitude,lat:e.row.longitude},o.setMapXy(this.center),console.log("kk--kk",o),this.dialogMapVisible=!this.dialogMapVisible,O.emit("wantOpenMapForCenter",this.center)},goToDepartmentPage(e){console.log("----去看看部门----",e),this.$router.push({name:"department",query:{id:e.row.id}})},goToTeacherPage(e){console.log("---去教师 -scope----",e.row.schoolName),this.$router.push({name:"teacher",query:{school:e.row.schoolName}})},getTopicPage(){this.FuncObj[3](this.requestData).then(e=>{console.log("-------page-拿到的数据--------",e),e.success?(this.topics=Object.values(e.data)[0],this.resultData=e.data,this.topic=h(this.topics[0]),console.log(this.topic),this.setObjPropsToNull(this.topic)):(n({message:"没有相关数据！！!",type:"warning"}),this.topics=[],this.topic={nodata:"NoData"})}).catch(e=>{console.log(e)})},showDialog(e,o){this.wantAdd=e,this.dat=h(o),e?(console.log("-----------------属性清空-------------------"),this.setObjPropsToNull(this.dat),this.dat={}):this.setSomeThing(this.topic,this.dat,2),this.dialogFormVisible=!0},del(e){const o={id:e};this.FuncObj[1](o).then(i=>{i.success?(console.log("--删除成功--"),this.getTopicPage(e),e%2!=0?this.getTopicPage(this.requestData.current-1):(console.log("--删除成功!--"),this.getTopicPage(this.requestData.current)),n({message:"数据删除成功!",type:"success"})):n({message:"删除警告,数据删除失败!",type:"warning"})}).catch(i=>{console.log("访问错误",i),n.error("删除错误，代码可能有错！"+i)})},async save(){await this.$refs.dialogFormRef.validate((e,o)=>{e?(console.log("submit!"),this.wantAdd?(console.log("   -------添加-----   "),this.FuncObj[0](this.dat).then(i=>{n({message:"数据添加成功!",type:"success"}),this.requestData.current=Math.ceil((this.resultData.total+1)/this.resultData.size),this.getTopicPage()}).catch(i=>{n.error("添加错误，网络接口出错！")})):(this.setSomeThing(this.topic,this.dat,1),this.FuncObj[2](this.dat).then(i=>{i.success?(n({message:"数据修改成功!",type:"success"}),this.getTopicPage()):n({message:"数据修改失败!",type:"warning"}),console.log(i)}).catch(i=>{n.error("修改错误，网络接口出错！")})),this.dialogFormVisible=!1):console.log("error submit!",o)})},resetForm(){console.log(this.$refs.dialogFormRef),this.$refs.dialogFormRef.resetFields(),this.wantAdd?this.topic=h(this.topic):this.topic=h(this.dat)},setObjPropsToNull(e){Object.keys(e).forEach(o=>{e[o]=void 0})},setSomeThing(e,o,i){Object.keys(e).forEach(m=>{i==0?o[m]=e[m]:e[m]=o[m]})},components:{BaiduMapModel:T}}}),G={class:"tools"},H={class:"dialog-footer"};function J(e,o,i,m,K,Q){const p=q,r=S,V=R,F=B,C=T,b=A,M=N,y=j,k=z;return c(),g("div",null,[u("div",G,[u("p",null,$(e.MainTitle)+"管理",1)]),u("div",null,[t(F,{"max-height":"600",data:e.topics,style:{width:"100%"}},{default:s(()=>[(c(!0),g(_,null,w(e.topic,(l,a)=>(c(),f(p,{prop:a,label:a,key:a.id,formatter:e.getCategoryNameFormat},null,8,["prop","label","formatter"]))),128)),t(p,{label:"部门"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.goToDepartmentPage(l)},{default:s(()=>[d("结构")]),_:2},1032,["onClick"])]),_:1}),t(p,{label:"教师"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.goToTeacherPage(l)},{default:s(()=>[d("成员")]),_:2},1032,["onClick"])]),_:1}),t(p,{label:"地址"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.showMapVisible(l)},{default:s(()=>[d("位置")]),_:2},1032,["onClick"])]),_:1}),t(p,{fixed:"right",label:"功能管理",width:"170"},{default:s(l=>[t(r,{size:"small",onClick:a=>e.showDialog(!1,l.row)},{default:s(()=>[d("编辑")]),_:2},1032,["onClick"]),t(V,{title:"删除将无法恢复！确定删除?",onConfirm:a=>e.del(l.row.id)},{reference:s(()=>[t(r,{size:"small",type:"danger"},{default:s(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),t(r,{icon:"Plus",style:{width:"100%","background-color":"#e3f7d8"},onClick:o[0]||(o[0]=l=>e.showDialog(!0,e.dat))}),t(b,{modelValue:e.dialogMapVisible,"onUpdate:modelValue":o[1]||(o[1]=l=>e.dialogMapVisible=l),width:"40%",center:""},{default:s(()=>[t(C,{Zoom:e.zoom,Center:e.center},null,8,["Zoom","Center"])]),_:1},8,["modelValue"]),t(b,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":o[3]||(o[3]=l=>e.dialogFormVisible=l),title:e.wantAdd?e.MainTitle+"添加":e.MainTitle+"修改"},{footer:s(()=>[u("span",H,[t(r,{onClick:o[2]||(o[2]=l=>e.resetForm())},{default:s(()=>[d("重置")]),_:1}),t(r,{type:"primary",onClick:e.save},{default:s(()=>[d(" 保存 ")]),_:1},8,["onClick"])])]),default:s(()=>[t(k,{ref:"dialogFormRef",model:e.dat,rules:e.rules},{default:s(()=>[(c(!0),g(_,null,w(e.topic,(l,a,v)=>(c(),f(y,{label:a,prop:a,key:v,"label-width":e.formLabelWidth},{default:s(()=>[(c(),f(M,{modelValue:e.dat[a],"onUpdate:modelValue":D=>e.dat[a]=D,autocomplete:"off",clearable:"",key:a},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label","prop","label-width"]))),128))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const de=E(X,[["render",J],["__scopeId","data-v-3ee35a16"]]);export{de as default};

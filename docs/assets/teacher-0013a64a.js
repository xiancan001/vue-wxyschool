import{_ as P,d as $,o as d,c as m,a as c,a3 as j,b as s,w as l,F as b,S as C,C as g,e as h}from"./index-9fc8cb19.js";import{E as k}from"./el-pagination-2194ca1b.js";import{E as O,a as S,b as q}from"./el-input-0a9f0811.js";import{E as r,a as N,b as A}from"./el-table-column-1dde40c8.js";import"./el-select-af701b75.js";import{E as I}from"./el-overlay-283751b4.js";import{E as B}from"./el-popover-84fb0416.js";import{E as M}from"./el-button-6154ee47.js";import{t as U,a as R,b as K,c as y,d as W}from"./teacher-76a220f4.js";/* empty css                   */import{c as f}from"./cloneDeep-fcde8700.js";import"./validator-a3bdd3fc.js";const G=$({data(){return{dialogMapVisible:!1,MainTitle:"教师",FuncObj:[U,R,K,y],pageSize:[3,5,7,10,20,30],dat:{},topics:[],resultData:{},requestData:{current:1,schoolName:"",size:7},topic:{createTime:"",depart:"",id:0,professional:"",school:"",teacherName:"",teacherNo:"",updateTime:"",userId:0},choseRow:{},dialogFormVisible:!1,formLabelWidth:70,dialogVisible:!1,wantAdd:!0,rules:{}}},mounted(){this.$route.query.school&&(console.log(" teacher 收到 params--->  ",this.$route.query.school),this.requestData.schoolName=this.$route.query.school,this.FuncObj[3]=W),this.getTopicPage()},methods:{goToKeyan(e){console.log("------------>",e),console.log(e.row," ===== ",e.row.userId),this.$router.push({name:"teakeyan",query:{userId:e.row.userId}})},getTopicPage(){this.FuncObj[3](this.requestData).then(e=>{console.log(Object.values(e.data)[0]),this.FuncObj[3]==y?this.topics=Object.values(e.data)[0]:(this.topics=Object.values(e.data)[0].records,this.resultData=e.data.page),console.log("---->",e)}).catch(e=>{console.log(e)})},handleSizeChange(e){this.requestData.size=e,this.getTopicPage()},handleCurrentChange(e){this.requestData.current=e,this.getTopicPage()},showDialog(e,t){this.wantAdd=e,this.dat=f(t),e?(console.log("-----------------属性清空-------------------"),this.setObjPropsToNull(this.dat),this.dat={schoolName:"四川大学",province:"四川省",area:"武侯区",city:"成都市",address:"民南路三段17号",deleted:0,description:"",enable:0,latitude:"104.081969",longitude:"30.626604"}):this.setSomeThing(this.topic,this.dat,2),this.dialogFormVisible=!0},del(e){const t={id:e};this.FuncObj[1](t).then(a=>{a.success?(console.log("--删除成功--"),this.getTopicPage(e),e%2!=0?this.getTopicPage(this.requestData.current-1):(console.log("--删除成功!--"),this.getTopicPage(this.requestData.current)),r({message:"数据删除成功!",type:"success"})):r({message:"删除警告,数据删除失败!",type:"warning"})}).catch(a=>{console.log("访问错误",a),r.error("删除错误，代码可能有错！"+a)})},async save(){await this.$refs.dialogFormRef.validate((e,t)=>{e?(console.log("submit!"),this.wantAdd?(console.log("   -------添加-----   "),this.FuncObj[0](this.dat).then(a=>{r({message:"数据添加成功!",type:"success"}),this.requestData.current=Math.ceil((this.resultData.total+1)/this.resultData.size),this.getTopicPage()}).catch(a=>{r.error("添加错误，网络接口出错！")})):(this.setSomeThing(this.topic,this.dat,1),this.FuncObj[2](this.dat).then(a=>{a.success?(r({message:"数据修改成功!",type:"success"}),this.getTopicPage()):r({message:"数据修改失败!",type:"warning"}),console.log(a)}).catch(a=>{r.error("修改错误，网络接口出错！")})),this.dialogFormVisible=!1):console.log("error submit!",t)})},resetForm(){console.log(this.$refs.dialogFormRef),this.$refs.dialogFormRef.resetFields(),this.wantAdd?this.topic=f(this.topic):this.topic=f(this.dat)},setObjPropsToNull(e){Object.keys(e).forEach(t=>{e[t]=void 0})},setSomeThing(e,t,a){Object.keys(e).forEach(u=>{a==0?t[u]=e[u]:e[u]=t[u]})}}}),L={class:"tools"},H={class:"dialog-footer"},J={style:{"margin-top":"10px","margin-left":"30%"}};function Q(e,t,a,u,X,Y){const p=A,n=M,T=B,_=N,D=O,F=S,w=q,z=I,v=k;return d(),m("div",null,[c("div",L,[c("p",null,j(e.MainTitle)+"管理",1)]),c("div",null,[s(_,{"max-height":"600",data:e.topics,style:{width:"100%"}},{default:l(()=>[(d(!0),m(b,null,C(e.topic,(o,i)=>(d(),g(p,{prop:i,label:i,key:i.id,formatter:e.getCategoryNameFormat},null,8,["prop","label","formatter"]))),128)),s(p,{label:"科研"},{default:l(o=>[s(n,{size:"small",onClick:i=>e.goToKeyan(o)},{default:l(()=>[h("成果")]),_:2},1032,["onClick"])]),_:1}),s(p,{fixed:"right",label:"功能管理",width:"170"},{default:l(o=>[s(n,{size:"small",onClick:i=>e.showDialog(!1,o.row)},{default:l(()=>[h("编辑")]),_:2},1032,["onClick"]),s(T,{title:"删除将无法恢复！确定删除?",onConfirm:i=>e.del(o.row.id)},{reference:l(()=>[s(n,{size:"small",type:"danger"},{default:l(()=>[h("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),s(n,{icon:"Plus",style:{width:"100%","background-color":"#e3f7d8"},onClick:t[0]||(t[0]=o=>e.showDialog(!0,e.dat))}),s(z,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":t[2]||(t[2]=o=>e.dialogFormVisible=o),title:e.wantAdd?e.MainTitle+"添加":e.MainTitle+"修改"},{footer:l(()=>[c("span",H,[s(n,{onClick:t[1]||(t[1]=o=>e.resetForm())},{default:l(()=>[h("重置")]),_:1}),s(n,{type:"primary",onClick:e.save},{default:l(()=>[h(" 保存 ")]),_:1},8,["onClick"])])]),default:l(()=>[s(w,{ref:"dialogFormRef",model:e.dat,rules:e.rules},{default:l(()=>[(d(!0),m(b,null,C(e.topic,(o,i,E)=>(d(),g(F,{label:i,prop:i,key:E,"label-width":e.formLabelWidth},{default:l(()=>[(d(),g(D,{modelValue:e.dat[i],"onUpdate:modelValue":V=>e.dat[i]=V,autocomplete:"off",clearable:"",key:i},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label","prop","label-width"]))),128))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),c("div",J,[s(v,{"current-page":e.resultData.current,"onUpdate:currentPage":t[3]||(t[3]=o=>e.resultData.current=o),"page-size":e.resultData.size,"onUpdate:pageSize":t[4]||(t[4]=o=>e.resultData.size=o),small:e.small,disabled:e.disabled,background:e.background,"page-sizes":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.resultData.total,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","small","disabled","background","page-sizes","total","onSizeChange","onCurrentChange"])])])}const ue=P(G,[["render",Q],["__scopeId","data-v-583000d7"]]);export{ue as default};

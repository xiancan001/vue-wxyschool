import{_ as $,d as C,o as n,c as h,a as m,a3 as O,b as l,w as a,F as b,S as _,C as f,e as p}from"./index-64734392.js";import{E as j}from"./el-overlay-d2281026.js";import{E as P,a as q,b as k}from"./el-input-0f3afc24.js";import{E as r,a as A,b as I}from"./el-table-column-ce9876c0.js";import{E as N}from"./el-popover-4f37abcc.js";import{E as B}from"./el-button-ef5f1b0d.js";import{d as M,a as S,b as R,c as z,e as U}from"./department-b37cfdf9.js";import"./maperstate-b84d8e7a.js";/* empty css                   */import{c as u}from"./cloneDeep-accf241e.js";const W=C({data(){return{center:{},dialogMapVisible:!1,MainTitle:"部门",FuncObj:[M,S,R,z],dat:{},topics:[],resultData:{},requestData:{schoolId:1},topic:{},choseRow:{},dialogFormVisible:!1,formLabelWidth:70,dialogVisible:!1,wantAdd:!0,rules:{}}},mounted(){console.log("拿到的属性 id 是",this.$route.query.id),this.$route.query.id&&(this.FuncObj[3]=U,this.requestData.schoolId=this.$route.query.id),this.getTopicPage()},methods:{getTopicPage(){this.FuncObj[3](this.requestData).then(e=>{console.log(Object.values(e.data)[0]),this.topics=Object.values(e.data)[0],this.resultData=e.data,this.topic=u(this.topics[0])}).catch(e=>{console.log(e)})},showDialog(e,t){this.wantAdd=e,this.dat=u(t),e?(console.log("-----------------属性清空-------------------"),this.setObjPropsToNull(this.dat),this.dat={schoolName:"四川大学",province:"四川省",area:"武侯区",city:"成都市",address:"民南路三段17号",deleted:0,description:"",enable:0,latitude:"104.081969",longitude:"30.626604"}):this.setSomeThing(this.topic,this.dat,2),this.dialogFormVisible=!0},del(e){const t={id:e};this.FuncObj[1](t).then(o=>{o.success?(console.log("--删除成功--"),this.getTopicPage(e),e%2!=0?this.getTopicPage(this.requestData.current-1):(console.log("--删除成功!--"),this.getTopicPage(this.requestData.current)),r({message:"数据删除成功!",type:"success"})):r({message:"删除警告,数据删除失败!",type:"warning"})}).catch(o=>{console.log("访问错误",o),r.error("删除错误，代码可能有错！"+o)})},async save(){await this.$refs.dialogFormRef.validate((e,t)=>{e?(console.log("submit!"),this.wantAdd?(console.log("   -------添加-----   "),this.FuncObj[0](this.dat).then(o=>{r({message:"数据添加成功!",type:"success"}),this.requestData.current=Math.ceil((this.resultData.total+1)/this.resultData.size),this.getTopicPage()}).catch(o=>{r.error("添加错误，网络接口出错！")})):(this.setSomeThing(this.topic,this.dat,1),this.FuncObj[2](this.dat).then(o=>{o.success?(r({message:"数据修改成功!",type:"success"}),this.getTopicPage()):r({message:"数据修改失败!",type:"warning"}),console.log(o)}).catch(o=>{r.error("修改错误，网络接口出错！")})),this.dialogFormVisible=!1):console.log("error submit!",t)})},resetForm(){console.log(this.$refs.dialogFormRef),this.$refs.dialogFormRef.resetFields(),this.wantAdd?this.topic=u(this.topic):this.topic=u(this.dat)},setObjPropsToNull(e){Object.keys(e).forEach(t=>{e[t]=void 0})},setSomeThing(e,t,o){Object.keys(e).forEach(d=>{o==0?t[d]=e[d]:e[d]=t[d]})}}}),G={class:"tools"},L={class:"dialog-footer"};function H(e,t,o,d,J,K){const g=I,c=B,F=N,w=A,y=P,T=q,E=k,D=j;return n(),h("div",null,[m("div",G,[m("p",null,O(e.MainTitle)+"管理",1)]),m("div",null,[l(w,{"max-height":"600",data:e.topics,style:{width:"100%"}},{default:a(()=>[(n(!0),h(b,null,_(e.topic,(i,s)=>(n(),f(g,{prop:s,label:s,key:s.id,formatter:e.getCategoryNameFormat},null,8,["prop","label","formatter"]))),128)),l(g,{fixed:"right",label:"功能管理",width:"170"},{default:a(i=>[l(c,{size:"small",onClick:s=>e.showDialog(!1,i.row)},{default:a(()=>[p("编辑")]),_:2},1032,["onClick"]),l(F,{title:"删除将无法恢复！确定删除?",onConfirm:s=>e.del(i.row.id)},{reference:a(()=>[l(c,{size:"small",type:"danger"},{default:a(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),l(c,{icon:"Plus",style:{width:"100%","background-color":"#e3f7d8"},onClick:t[0]||(t[0]=i=>e.showDialog(!0,e.dat))}),l(D,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":t[2]||(t[2]=i=>e.dialogFormVisible=i),title:e.wantAdd?e.MainTitle+"添加":e.MainTitle+"修改"},{footer:a(()=>[m("span",L,[l(c,{onClick:t[1]||(t[1]=i=>e.resetForm())},{default:a(()=>[p("重置")]),_:1}),l(c,{type:"primary",onClick:e.save},{default:a(()=>[p(" 保存 ")]),_:1},8,["onClick"])])]),default:a(()=>[l(E,{ref:"dialogFormRef",model:e.dat,rules:e.rules},{default:a(()=>[(n(!0),h(b,null,_(e.topic,(i,s,V)=>(n(),f(T,{label:s,prop:s,key:V,"label-width":e.formLabelWidth},{default:a(()=>[(n(),f(y,{modelValue:e.dat[s],"onUpdate:modelValue":v=>e.dat[s]=v,autocomplete:"off",clearable:"",key:s},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label","prop","label-width"]))),128))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const le=$(W,[["render",H],["__scopeId","data-v-0439a779"]]);export{le as default};

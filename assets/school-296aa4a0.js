import{_ as D,d as $,o as c,c as h,a as p,a3 as P,b as t,w as l,a9 as O,F as _,S as w,C as g,e as d}from"./index-f62cc32f.js";import{E as j,a as N,b as z}from"./el-input-12cc074f.js";import{E as A}from"./el-overlay-1ec9b8d8.js";import{_ as V}from"./BaiduMapModel-a8bc705f.js";import{E as r,a as B,b as q}from"./el-table-column-c3297e3c.js";import{E as R}from"./el-popover-01084f51.js";import{E as S}from"./el-button-302ba8ae.js";import{s as U,a as I,b as W,c as Z}from"./school-3e202a9c.js";import{M as L}from"./maperstate-50431105.js";/* empty css                   */import{c as f}from"./cloneDeep-a88f16a9.js";const X=$({data(){return{center:{},dialogMapVisible:!1,MainTitle:"学校",FuncObj:[U,I,W,Z],dat:{},topics:[],resultData:{},topic:{schoolName:"",province:"",area:"",city:"",address:"",deleted:0,description:"",enable:0,latitude:"",longitude:""},choseRow:{},dialogFormVisible:!1,formLabelWidth:70,dialogVisible:!1,wantAdd:!0,rules:{}}},mounted(){this.getTopicPage()},methods:{showMapVisible(e){const o=L();this.center={lng:e.row.latitude,lat:e.row.longitude},o.setMapXy(this.center),console.log("kk--kk",o),this.dialogMapVisible=!this.dialogMapVisible,O.emit("wantOpenMapForCenter",this.center)},goToDepartmentPage(e){console.log("----去看看部门----",e),this.$router.push({name:"department",query:{id:e.row.id}})},goToTeacherPage(e){console.log("---去教师 -scope----",e.row.schoolName),this.$router.push({name:"teacher",query:{school:e.row.schoolName}})},getTopicPage(){this.FuncObj[3](this.requestData).then(e=>{console.log(Object.values(e.data)[0]),this.topics=Object.values(e.data)[0],this.resultData=e.data}).catch(e=>{console.log(e)})},showDialog(e,o){this.wantAdd=e,this.dat=f(o),e?(console.log("-----------------属性清空-------------------"),this.setObjPropsToNull(this.dat),this.dat={schoolName:"四川大学",province:"四川省",area:"武侯区",city:"成都市",address:"民南路三段17号",deleted:0,description:"",enable:0,latitude:"104.081969",longitude:"30.626604"}):this.setSomeThing(this.topic,this.dat,2),this.dialogFormVisible=!0},del(e){const o={id:e};this.FuncObj[1](o).then(i=>{i.success?(console.log("--删除成功--"),this.getTopicPage(e),e%2!=0?this.getTopicPage(this.requestData.current-1):(console.log("--删除成功!--"),this.getTopicPage(this.requestData.current)),r({message:"数据删除成功!",type:"success"})):r({message:"删除警告,数据删除失败!",type:"warning"})}).catch(i=>{console.log("访问错误",i),r.error("删除错误，代码可能有错！"+i)})},async save(){await this.$refs.dialogFormRef.validate((e,o)=>{e?(console.log("submit!"),this.wantAdd?(console.log("   -------添加-----   "),this.FuncObj[0](this.dat).then(i=>{r({message:"数据添加成功!",type:"success"}),this.requestData.current=Math.ceil((this.resultData.total+1)/this.resultData.size),this.getTopicPage()}).catch(i=>{r.error("添加错误，网络接口出错！")})):(this.setSomeThing(this.topic,this.dat,1),this.FuncObj[2](this.dat).then(i=>{i.success?(r({message:"数据修改成功!",type:"success"}),this.getTopicPage()):r({message:"数据修改失败!",type:"warning"}),console.log(i)}).catch(i=>{r.error("修改错误，网络接口出错！")})),this.dialogFormVisible=!1):console.log("error submit!",o)})},resetForm(){console.log(this.$refs.dialogFormRef),this.$refs.dialogFormRef.resetFields(),this.wantAdd?this.topic=f(this.topic):this.topic=f(this.dat)},setObjPropsToNull(e){Object.keys(e).forEach(o=>{e[o]=void 0})},setSomeThing(e,o,i){Object.keys(e).forEach(m=>{i==0?o[m]=e[m]:e[m]=o[m]})},components:{BaiduMapModel:V}}}),G={class:"tools"},H={class:"dialog-footer"};function J(e,o,i,m,K,Q){const u=q,n=S,T=R,F=B,C=V,b=A,v=j,M=N,y=z;return c(),h("div",null,[p("div",G,[p("p",null,P(e.MainTitle)+"管理",1)]),p("div",null,[t(F,{"max-height":"600",data:e.topics,style:{width:"100%"}},{default:l(()=>[(c(!0),h(_,null,w(e.topic,(s,a)=>(c(),g(u,{prop:a,label:a,key:a.id,formatter:e.getCategoryNameFormat},null,8,["prop","label","formatter"]))),128)),t(u,{label:"部门"},{default:l(s=>[t(n,{size:"small",onClick:a=>e.goToDepartmentPage(s)},{default:l(()=>[d("结构")]),_:2},1032,["onClick"])]),_:1}),t(u,{label:"教师"},{default:l(s=>[t(n,{size:"small",onClick:a=>e.goToTeacherPage(s)},{default:l(()=>[d("成员")]),_:2},1032,["onClick"])]),_:1}),t(u,{label:"地址"},{default:l(s=>[t(n,{size:"small",onClick:a=>e.showMapVisible(s)},{default:l(()=>[d("位置")]),_:2},1032,["onClick"])]),_:1}),t(u,{fixed:"right",label:"功能管理",width:"170"},{default:l(s=>[t(n,{size:"small",onClick:a=>e.showDialog(!1,s.row)},{default:l(()=>[d("编辑")]),_:2},1032,["onClick"]),t(T,{title:"删除将无法恢复！确定删除?",onConfirm:a=>e.del(s.row.id)},{reference:l(()=>[t(n,{size:"small",type:"danger"},{default:l(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),t(n,{icon:"Plus",style:{width:"100%","background-color":"#e3f7d8"},onClick:o[0]||(o[0]=s=>e.showDialog(!0,e.dat))}),t(b,{modelValue:e.dialogMapVisible,"onUpdate:modelValue":o[1]||(o[1]=s=>e.dialogMapVisible=s),width:"40%",center:""},{default:l(()=>[t(C,{Zoom:e.zoom,Center:e.center},null,8,["Zoom","Center"])]),_:1},8,["modelValue"]),t(b,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":o[3]||(o[3]=s=>e.dialogFormVisible=s),title:e.wantAdd?e.MainTitle+"添加":e.MainTitle+"修改"},{footer:l(()=>[p("span",H,[t(n,{onClick:o[2]||(o[2]=s=>e.resetForm())},{default:l(()=>[d("重置")]),_:1}),t(n,{type:"primary",onClick:e.save},{default:l(()=>[d(" 保存 ")]),_:1},8,["onClick"])])]),default:l(()=>[t(y,{ref:"dialogFormRef",model:e.dat,rules:e.rules},{default:l(()=>[(c(!0),h(_,null,w(e.topic,(s,a,k)=>(c(),g(M,{label:a,prop:a,key:k,"label-width":e.formLabelWidth},{default:l(()=>[(c(),g(v,{modelValue:e.dat[a],"onUpdate:modelValue":E=>e.dat[a]=E,autocomplete:"off",clearable:"",key:a},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label","prop","label-width"]))),128))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const de=D(X,[["render",J],["__scopeId","data-v-fd634977"]]);export{de as default};
